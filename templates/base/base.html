{% load core_tags i18n %}
{# Base Template - Django Base Project #}
{# Template Base - Projeto Django Base #}
{% comment %}
  Full-height layout with navbar, main content, and footer.
  Bootstrap 5.3 with custom green primary color and HTMX support.

  Layout de altura completa com navbar, conteúdo principal e footer.
  Bootstrap 5.3 com cor primária verde personalizada e suporte HTMX.
{% endcomment %}
<!DOCTYPE html>
<html lang="{% firstof LANGUAGE_CODE 'en' %}" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Django Base - Modern web application{% endblock %}">
    <title>{% block title %}Django Base{% endblock %}</title>

    {# Bootstrap 5.3 CSS / CSS Bootstrap 5.3 #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    {# Bootstrap Icons / Ícones Bootstrap #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    {# HTMX for dynamic interactions / HTMX para interações dinâmicas #}
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    {# Custom CSS - Green primary color / CSS customizado - Cor primária verde #}
    <style>
        :root {
            --bs-primary: #198754;
            --bs-primary-rgb: 25, 135, 84;
        }
        .bg-primary {
            background-color: #198754 !important;
        }
        .btn-primary {
            background-color: #198754;
            border-color: #198754;
        }
        .btn-primary:hover {
            background-color: #157347;
            border-color: #146c43;
        }
        .text-primary {
            color: #198754 !important;
        }
        .navbar-dark .navbar-brand,
        .navbar-dark .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.95);
        }
        .nav-link:hover,
        .dropdown-item:hover,
        .card:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }
        a.text-decoration-none:hover .card {
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15) !important;
        }
    </style>

    {% block extrastyle %}{% endblock %}
</head>
<body class="d-flex flex-column h-100">
    {# Navigation Bar - Green theme / Barra de Navegação - Tema verde #}
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">
                <i class="bi bi-rocket-takeoff"></i> Django Base
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link {% is_active_url 'home' %}" href="{% url 'home' %}">{% trans "Home" %}</a>
                    </li>
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle {% is_active_url 'profile' %}" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle"></i> {{ user.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="bi bi-person"></i> {% trans "Profile" %}</a></li>
                                <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i class="bi bi-gear"></i> {% trans "Admin" %}</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i> {% trans "Logout" %}</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link {% is_active_url 'login' %}" href="{% url 'login' %}">{% trans "Login" %}</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-success text-white px-3 ms-2" href="{% url 'register' %}">{% trans "Register" %}</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {# Main Content Area / Área de Conteúdo Principal #}
    <main class="flex-shrink-0">
        {# Django Messages Display / Exibição de Mensagens Django #}
        {% if messages %}
            <div class="container mt-3" id="messages-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {# Page Content Block / Bloco de Conteúdo da Página #}
        {% block content %}{% endblock %}
    </main>

    {# Footer / Rodapé #}
    <footer class="mt-auto py-3 bg-light">
        <div class="container">
             <p class="text-center text-muted mb-0">
                &copy; {% now "Y" %} Django Base. {% trans "All rights reserved" %}.
                <a href="{% url 'about' %}" class="text-decoration-none ms-2">{% trans "About" %}</a>
                <a href="#" class="text-decoration-none ms-2" data-bs-toggle="modal" data-bs-target="#termsModal">{% trans "Terms and Conditions" %}</a>
             </p>
        </div>
    </footer>

    {# Terms and Conditions Modal / Modal de Termos e Condições #}
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="termsModalLabel"><i class="bi bi-file-text"></i> {% trans "Terms and Conditions" %}</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>{% trans "1. Acceptance of Terms" %}</h6>
                    <p>{% trans "By accessing and using this Django Base template, you accept and agree to be bound by the terms and provision of this agreement." %}</p>

                    <h6>{% trans "2. Use License" %}</h6>
                    <p>{% trans "This is an open-source template. Permission is granted to use, copy, modify, and distribute this software and its documentation for any purpose, provided that the above copyright notice and this permission notice appear in all copies." %}</p>

                    <h6>{% trans "3. Disclaimer" %}</h6>
                    <p>{% trans "This template is provided 'as is' without warranty of any kind, express or implied. In no event shall the authors be liable for any claim, damages or other liability arising from the use of the software." %}</p>

                    <h6>{% trans "4. Privacy" %}</h6>
                    <p>{% trans "We respect your privacy. Any personal information collected will be handled in accordance with applicable data protection laws." %}</p>

                    <h6>{% trans "5. Modifications" %}</h6>
                    <p>{% trans "We reserve the right to modify these terms at any time. Continued use of the template constitutes acceptance of modified terms." %}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>

    {# Bootstrap Bundle JS (Popper included) / Bootstrap Bundle JS (Popper incluído) #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    {# HTMX CSRF Token Configuration / Configuração CSRF Token HTMX #}
    <script>
        document.body.addEventListener('htmx:configRequest', (event) => {
            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });

        // Auto-dismiss alerts after 5 seconds / Auto-fechar alertas após 5 segundos
        document.addEventListener('DOMContentLoaded', () => {
            const alerts = document.querySelectorAll('.alert');
            const container = document.getElementById('messages-container');

            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();

                    // Remove container margin when all alerts are closed
                    // Remove margin do container quando todos alertas fechados
                    setTimeout(() => {
                        if (container && container.querySelectorAll('.alert').length === 0) {
                            container.remove();
                        }
                    }, 200);
                }, 5000);
            });
        });
    </script>

    {% block extrajs %}{% endblock %}
</body>
</html>
