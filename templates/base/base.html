{% load core_tags i18n %}
{# Base Template - Django Base Project #}
{# Template Base - Projeto Django Base #}
{% comment %}
  Full-height layout with navbar, main content, and footer.
  Bootstrap 5.3 with custom green primary color and HTMX support.

  Layout de altura completa com navbar, conteúdo principal e footer.
  Bootstrap 5.3 com cor primária verde personalizada e suporte HTMX.
{% endcomment %}
<!DOCTYPE html>
<html lang="{% firstof LANGUAGE_CODE 'en' %}" class="h-100" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Django Base - Modern web application{% endblock %}">
    <title>{% block title %}Django Base{% endblock %}</title>

    {# Dark Mode - Load theme before page renders / Carregar tema antes da página renderizar #}
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-bs-theme', savedTheme);
        })();
    </script>

    {# Bootstrap 5.3 CSS / CSS Bootstrap 5.3 #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    {# Bootstrap Icons / Ícones Bootstrap #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    {# HTMX for dynamic interactions / HTMX para interações dinâmicas #}
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    {# Custom CSS - Green primary color & Dark Mode / CSS customizado - Cor primária verde & Dark Mode #}
    <style>
        /* Custom green primary color / Cor primária verde customizada */
        :root {
            --bs-primary: #198754;
            --bs-primary-rgb: 25, 135, 84;
            --bs-success: #198754;
            --bs-success-rgb: 25, 135, 84;
        }

        /* Smooth transitions for theme change / Transições suaves para mudança de tema */
        html {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card, .modal-content, .dropdown-menu, footer {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Primary color overrides / Sobrescrições de cor primária */
        .bg-primary {
            background-color: #198754 !important;
        }
        .btn-primary {
            background-color: #198754;
            border-color: #198754;
        }
        .btn-primary:hover {
            background-color: #157347;
            border-color: #146c43;
        }
        .text-primary {
            color: #198754 !important;
        }

        /* Navbar styles / Estilos da navbar */
        .navbar-dark .navbar-brand,
        .navbar-dark .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.95);
        }

        /* Hover effects / Efeitos de hover */
        .nav-link:hover,
        .dropdown-item:hover,
        .card:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }

        a.text-decoration-none:hover .card {
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15) !important;
        }

        /* Dark mode specific styles / Estilos específicos dark mode */
        [data-bs-theme="dark"] {
            --bs-body-bg: #212529;
            --bs-body-color: #dee2e6;
        }

        [data-bs-theme="dark"] .bg-light {
            background-color: #343a40 !important;
        }

        [data-bs-theme="dark"] .text-muted {
            color: #adb5bd !important;
        }

        [data-bs-theme="dark"] .card {
            background-color: #2b3035;
            border-color: #495057;
        }

        [data-bs-theme="dark"] .modal-content {
            background-color: #2b3035;
            border-color: #495057;
        }

        [data-bs-theme="dark"] .dropdown-menu {
            background-color: #2b3035;
            border-color: #495057;
        }

        [data-bs-theme="dark"] .dropdown-item:hover {
            background-color: #343a40;
        }

        /* Theme toggle button / Botão de troca de tema */
        .theme-toggle {
            cursor: pointer;
            border: none;
            background: none;
            padding: 0.5rem;
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-icon {
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(20deg);
        }
    </style>

    {% block extrastyle %}{% endblock %}
</head>
<body class="d-flex flex-column h-100">
    {# Navigation Bar - Green theme / Barra de Navegação - Tema verde #}
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">
                <i class="bi bi-rocket-takeoff"></i> Django Base
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link {% is_active_url 'home' %}" href="{% url 'home' %}">
                            <i class="bi bi-house"></i> {% trans "Home" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% is_active_url 'project_info' %}" href="{% url 'project_info' %}">
                            <i class="bi bi-info-circle"></i> {% trans "Project" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% is_active_url 'products' %}" href="{% url 'products' %}">
                            <i class="bi bi-box-seam"></i> {% trans "Products" %}
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-speedometer2"></i> {% trans "Monitoring" %}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/health-status/" target="_blank"><i class="bi bi-heart-pulse text-danger"></i> {% trans "Health Check" %}</a></li>
                            <li><a class="dropdown-item" href="http://localhost:9090" target="_blank" rel="noopener noreferrer"><i class="bi bi-graph-up text-danger"></i> Prometheus</a></li>
                            <li><a class="dropdown-item" href="http://localhost:3000" target="_blank" rel="noopener noreferrer"><i class="bi bi-speedometer2 text-warning"></i> Grafana</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/api/docs/" target="_blank"><i class="bi bi-book text-success"></i> {% trans "API Docs" %} (Swagger)</a></li>
                            <li><a class="dropdown-item" href="/api/redoc/" target="_blank"><i class="bi bi-file-text text-info"></i> {% trans "API Docs" %} (ReDoc)</a></li>
                        </ul>
                    </li>
                    {# Language Selector / Seletor de Idioma #}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-label="Select language">
                            <i class="bi bi-translate"></i>
                            {% if LANGUAGE_CODE == 'pt-br' %}PT{% else %}EN{% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <form action="{% url 'set_language' %}" method="post" class="px-3 py-2">
                                    {% csrf_token %}
                                    <input type="hidden" name="language" value="en">
                                    <input type="hidden" name="next" value="{{ request.path }}">
                                    <button type="submit" class="dropdown-item">
                                        <i class="bi bi-flag"></i> English
                                    </button>
                                </form>
                            </li>
                            <li>
                                <form action="{% url 'set_language' %}" method="post" class="px-3 py-2">
                                    {% csrf_token %}
                                    <input type="hidden" name="language" value="pt-br">
                                    <input type="hidden" name="next" value="{{ request.path }}">
                                    <button type="submit" class="dropdown-item">
                                        <i class="bi bi-flag-fill"></i> Português (Brasil)
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                    {# Dark Mode Toggle / Toggle Dark Mode #}
                    <li class="nav-item">
                        <button class="nav-link theme-toggle" id="themeToggle" aria-label="Toggle theme">
                            <i class="bi bi-sun-fill theme-icon" id="themeIcon"></i>
                        </button>
                    </li>
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle {% is_active_url 'profile' %}" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle"></i> {{ user.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="bi bi-person"></i> {% trans "Profile" %}</a></li>
                                <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i class="bi bi-gear"></i> {% trans "Admin" %}</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i> {% trans "Logout" %}</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link {% is_active_url 'login' %}" href="{% url 'login' %}">{% trans "Login" %}</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-success text-white px-3 ms-2" href="{% url 'register' %}">{% trans "Register" %}</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {# Main Content Area / Área de Conteúdo Principal #}
    <main class="flex-shrink-0">
        {# Django Messages Display / Exibição de Mensagens Django #}
        {% if messages %}
            <div class="container mt-3" id="messages-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {# Page Content Block / Bloco de Conteúdo da Página #}
        {% block content %}{% endblock %}
    </main>

    {# Footer / Rodapé #}
    <footer class="mt-auto py-3 bg-light">
        <div class="container">
             <p class="text-center text-muted mb-0">
                &copy; {% now "Y" %} Django Base. {% trans "All rights reserved" %}.
                <a href="{% url 'project_info' %}" class="text-decoration-none ms-2">{% trans "Project Info" %}</a>
                <a href="https://github.com/mugubr/django_base" target="_blank" rel="noopener noreferrer" class="text-decoration-none ms-2"><i class="bi bi-github"></i> GitHub</a>
                <a href="#" class="text-decoration-none ms-2" data-bs-toggle="modal" data-bs-target="#termsModal">{% trans "Terms" %}</a>
             </p>
        </div>
    </footer>

    {# Terms and Conditions Modal / Modal de Termos e Condições #}
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="termsModalLabel"><i class="bi bi-file-text"></i> {% trans "Terms and Conditions" %}</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>{% trans "1. Acceptance of Terms" %}</h6>
                    <p>{% trans "By accessing and using this Django Base template, you accept and agree to be bound by the terms and provision of this agreement." %}</p>

                    <h6>{% trans "2. Use License" %}</h6>
                    <p>{% trans "This is an open-source template. Permission is granted to use, copy, modify, and distribute this software and its documentation for any purpose, provided that the above copyright notice and this permission notice appear in all copies." %}</p>

                    <h6>{% trans "3. Disclaimer" %}</h6>
                    <p>{% trans "This template is provided 'as is' without warranty of any kind, express or implied. In no event shall the authors be liable for any claim, damages or other liability arising from the use of the software." %}</p>

                    <h6>{% trans "4. Privacy" %}</h6>
                    <p>{% trans "We respect your privacy. Any personal information collected will be handled in accordance with applicable data protection laws." %}</p>

                    <h6>{% trans "5. Modifications" %}</h6>
                    <p>{% trans "We reserve the right to modify these terms at any time. Continued use of the template constitutes acceptance of modified terms." %}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>

    {# Bootstrap Bundle JS (Popper included) / Bootstrap Bundle JS (Popper incluído) #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    {# HTMX CSRF Token Configuration / Configuração CSRF Token HTMX #}
    <script>
        document.body.addEventListener('htmx:configRequest', (event) => {
            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });

        // Auto-dismiss alerts after 5 seconds / Auto-fechar alertas após 5 segundos
        document.addEventListener('DOMContentLoaded', () => {
            const alerts = document.querySelectorAll('.alert');
            const container = document.getElementById('messages-container');

            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();

                    // Remove container margin when all alerts are closed
                    // Remove margin do container quando todos alertas fechados
                    setTimeout(() => {
                        if (container && container.querySelectorAll('.alert').length === 0) {
                            container.remove();
                        }
                    }, 200);
                }, 5000);
            });
        });

        // Dark Mode Toggle / Toggle Dark Mode
        (function() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const html = document.documentElement;

            // Update icon based on current theme / Atualizar ícone baseado no tema atual
            function updateIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'bi bi-moon-stars-fill theme-icon';
                } else {
                    themeIcon.className = 'bi bi-sun-fill theme-icon';
                }
            }

            // Set initial icon / Definir ícone inicial
            const currentTheme = localStorage.getItem('theme') || 'light';
            updateIcon(currentTheme);

            // Toggle theme on button click / Alternar tema ao clicar no botão
            themeToggle.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-bs-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                html.setAttribute('data-bs-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon(newTheme);
            });
        })();
    </script>

    {% block extrajs %}{% endblock %}
</body>
</html>
